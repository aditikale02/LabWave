<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnetic Susceptibility Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: url('bg1.png') no-repeat center center fixed;
            background-size: cover;
            text-align: center;
            margin: 20px

            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
        }
        .container {
            background: #f3f1f1;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: auto;
        }
        input {
            margin: 5px;
            padding: 8px;
            width: 80px;
        }
        button {
            padding: 10px 15px;
            border: none;
            background: #170167;
            color: white;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #591bc4;
        }
        canvas {
            max-width: 100%;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Magnetic Susceptibility Calculator</h2>
        <label>Number of Observations: <input type="number" id="numObservations" value="5" min="2"></label>
        <button onclick="generateFields()">Generate Fields</button>
        <div id="inputFields"></div>
        <button onclick="calculate()">Calculate</button>
        <button onclick="graph()">Graph Plot</button>
        <h3>Slope: <span id="slopeOutput">N/A</span></h3>
        <h3>Susceptibility: <span id="susceptibilityOutput">N/A</span></h3>
    </div>
    <canvas id="myChart"></canvas>
    
    <script>
        const p = 1.443, g = 980;
        
        function generateFields() {
            const n = parseInt(document.getElementById("numObservations").value);
            let fields = "";
            for (let i = 0; i < n; i++) {
                fields += `<div><label>H[${i+1}] (KG): <input type='number' id='H${i}' step='0.01'></label>
                <label>L[${i+1}] (cm): <input type='number' id='L${i}' step='0.01'></label></div>`;
            }
            document.getElementById("inputFields").innerHTML = fields;
        }

        function graph() {
            window.location.href = "graph_plotter.html";
        }

        function calculate() {
            const n = parseInt(document.getElementById("numObservations").value);
            if (n < 2) {
                alert("Please enter at least 2 observations.");
                return;
            }

            let H = [], L = [], H2 = [], Rise = [];

            for (let i = 0; i < n; i++) {
                H[i] = parseFloat(document.getElementById(`H${i}`).value) || 0;
                L[i] = parseFloat(document.getElementById(`L${i}`).value) || 0;
                H2[i] = Math.pow(H[i], 2) * 1e6;
            }

            for (let i = 0; i < n; i++) {
                Rise[i] = L[i] - L[0]; // Ensure the first value is zero-based
            }

            // Linear Regression to Find Best-Fit Slope
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            for (let i = 1; i < n; i++) { // Skip first point to avoid (0,0)
                sumX += H2[i];
                sumY += Rise[i];
                sumXY += H2[i] * Rise[i];
                sumXX += H2[i] * H2[i];
            }
            
            let slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            let susceptibility = 2 * p * g * slope;

            document.getElementById("slopeOutput").innerText = slope.toExponential(4);
            document.getElementById("susceptibilityOutput").innerText = susceptibility.toExponential(4);

            // Plot Graph
            const ctx = document.getElementById("myChart").getContext("2d");
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: H2.map((h2, i) => `H²[${i+1}]`),
                    datasets: [{
                        label: 'Rise vs Magnetic Field (H²)',
                        data: Rise,
                        borderColor: 'blue',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 5,
                        pointBackgroundColor: 'red'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Magnetic Field Squared (H²)' } },
                        y: { title: { display: true, text: 'Rise of Solution (cm)' } }
                    }
                }
            });
        }
    </script>
</body>
</html>
