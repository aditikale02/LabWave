import React, { useState } from "react";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from "recharts";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

const ExperimentPage = () => {
  const [data, setData] = useState([]);
  const [temp, setTemp] = useState("");
  const [current, setCurrent] = useState("");
  const voltage = 5; // Constant voltage
  const boltzmann = 8.617e-5; // Boltzmann constant in eV/K

  const addData = () => {
    const T = parseFloat(temp);
    const I = parseFloat(current);
    if (T && I) {
      const invT = 1 / T;
      const R = voltage / I;
      const logR = Math.log10(R);
      setData([...data, { T, I, invT, R, logR }]);
      setTemp("");
      setCurrent("");
    }
  };

  const calculateSlope = () => {
    if (data.length < 2) return 0;
    const n = data.length;
    const sumX = data.reduce((sum, d) => sum + d.invT, 0);
    const sumY = data.reduce((sum, d) => sum + d.logR, 0);
    const sumXY = data.reduce((sum, d) => sum + d.invT * d.logR, 0);
    const sumXX = data.reduce((sum, d) => sum + d.invT * d.invT, 0);
    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    return slope;
  };

  const slope = calculateSlope();
  const beta = slope * 2.303;
  const Eg = boltzmann * beta * 2;

  return (
    <div className="p-4">
      <h1 className="text-xl font-bold mb-4">Experiment Data Entry</h1>
      <div className="flex gap-2">
        <input type="number" placeholder="Temperature (K)" value={temp} onChange={(e) => setTemp(e.target.value)} className="border p-2" />
        <input type="number" placeholder="Current (A)" value={current} onChange={(e) => setCurrent(e.target.value)} className="border p-2" />
        <Button onClick={addData}>Add</Button>
      </div>
      <table className="w-full border mt-4">
        <thead>
          <tr className="bg-gray-200">
            <th>T (K)</th>
            <th>I (A)</th>
            <th>1/T (K⁻¹)</th>
            <th>R (Ω)</th>
            <th>log(R)</th>
          </tr>
        </thead>
        <tbody>
          {data.map((row, index) => (
            <tr key={index} className="border">
              <td>{row.T}</td>
              <td>{row.I}</td>
              <td>{row.invT.toFixed(5)}</td>
              <td>{row.R.toFixed(2)}</td>
              <td>{row.logR.toFixed(5)}</td>
            </tr>
          ))}
        </tbody>
      </table>
      <Card className="mt-4 p-4">
        <CardContent>
          <p><strong>Slope:</strong> {slope.toFixed(5)}</p>
          <p><strong>Beta (β):</strong> {beta.toFixed(5)}</p>
          <p><strong>Energy Gap (Eg):</strong> {Eg.toFixed(5)} eV</p>
        </CardContent>
      </Card>
      <div className="mt-4">
        <h2 className="text-lg font-bold mb-2">Graph: log(R) vs 1/T</h2>
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={data}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="invT" label={{ value: "1/T (K⁻¹)", position: "insideBottom" }} />
            <YAxis label={{ value: "log(R)", angle: -90, position: "insideLeft" }} />
            <Tooltip />
            <Line type="monotone" dataKey="logR" stroke="#8884d8" strokeWidth={2} />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
};

export default ExperimentPage;